#!/bin/bash
# Script de nettoyage automatique Docker
# Généré par Ansible

set -e

echo "$(date): Début du nettoyage Docker"

# Supprimer les conteneurs arrêtés
echo "Suppression des conteneurs arrêtés..."
docker container prune -f

# Supprimer les images non utilisées
echo "Suppression des images non utilisées..."
docker image prune -f

# Supprimer les volumes non utilisés
echo "Suppression des volumes non utilisés..."
docker volume prune -f

# Supprimer les réseaux non utilisés
echo "Suppression des réseaux non utilisés..."
docker network prune -f

# Supprimer les données de build cache
echo "Suppression du cache de build..."
docker builder prune -f

# Afficher l'espace disque utilisé
echo "Espace disque utilisé par Docker:"
docker system df

# Nettoyer les logs trop volumineux
echo "Nettoyage des logs Docker..."
find /var/lib/docker/containers/ -name "*.log" -exec truncate -s 0 {} \;

echo "$(date): Nettoyage Docker terminé"